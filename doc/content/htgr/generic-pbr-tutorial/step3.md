## Step 3

In this step, we make the flow problem heterogeneous.
Above the pebble bed in a pebble-bed reactor is usually a cavity that is only filled with fluid (i.e., it has a porosity of 1). The interface between the cavity and the bed is modeled as a sharp discontinuity in both porosity and correlations (i.e., momentum and energy transfer; e.g., very small pressure drop in the cavity and much larger pressure drop in the bed).

### Modifying the Geometry

We distinguish the two regions, cavity and bed, by assigning the elements in each to different blocks. This is accomplished in the mesh generation process.

Instead of using `GeneratedMeshGenerator`, we use the
`CartesianMeshGenerator`.

!listing htgr/generic-pbr-tutorial/step3.i block=gen

Note that we added ${cavity_height} as a real variable at the top of the input file. `CartesianMeshGenerator` is explained in detail [here](https://mooseframework.inl.gov/moose/source/meshgenerators/CartesianMeshGenerator.html). The main differences between `CartesianMeshGenerator` and `GeneratedMeshGenerator` are that
`CartesianMeshGenerator` specifies the thickness of regions
in the x, y, and z-direction instead of simply giving end point
and number of elements and that it allows to assign `subdomain_id`
for each of the "macro-regions" laid out by the `dx` and `dy` parameters.
In our case, we have one entry in `dx` and two entries in `dy` so we have
$1 \times 2$ entries in `subdomain_id`. The order of entries in
the `subdomain_id` parameter is:

!listing
(0,0) (1,0), (2,0), ... , (0,1), (1,1), ... (nx,ny)

where each `(ix,iy)` is one entry that gives the subdomain (or synonymously block id) of zone located at grid coordinates `ix` and `iy`.
The indexing goes from small to large coordinate values, so we fill the `subdomain_id` from the left bottom to the right top.

For convenience, we label block 1 as bed and block 2 as cavity using the `RenameBlockGenerator`:

!listing htgr/generic-pbr-tutorial/step3.i block=rename_blocks

That allows us to use block names rather than ids in the block restrictions of the input file.

The geometry for Step 3 is depicted in [step3geom]. The mesh can be generated by:

!listing
./pronghorn-opt -i step3.i --mesh-only

creating the file `step3_in.e` that can be visualized using paraview.

!media generic-pbr-tutorial/step3_geometry.png
        style=width:10%
        id=step3geom
        caption=Geometry for Step 3.
